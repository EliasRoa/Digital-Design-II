<!doctype html>

<html lang="en">

<head>
  <meta charset="utf-8">

  <title>Digial Design II Final Project</title>
  <meta name="description" content="Digial Design II Final Project">
  <meta name="author" content="https://github.com/EliasRoa">

  <link rel="stylesheet" href="css/site.css?v=1.0">

</head>

<body>
  <div id="content"></div>

  <script src="js/site.js"></script>
  <script>
    var html = document.getElementById('content');
    //html.innerHTML = "Hello from JS";
    var connected = false;

    function processInput() {
      html.innerHTML = "<p>processInput()</p>";
    }

    function update() {
      html.innerHTML += "<p>update()</p>";
    }

    var lastTimestamp = 0;

    function render(timestamp) {
      var elapsed = timestamp - lastTimestamp;
      lastTimestamp = timestamp;
      var calculatedFps = 1000 / elapsed;

      html.innerHTML += `<p>fps = ${calculatedFps}</p>`;
    }

    // Gameloop
    function loop(timestamp) {
      processInput();
      update();
      render(timestamp);

      // If the controller is connected, then do another loop.
      if (connected == true) {
        doLoop();
      } else {
        disconnected();
      }

    }

    // Trigger a new exectution of the game loop.
    // try 2, 5, 10, 20, 30, 40, 50, 60;
    var fps = 2;

    function doLoop() {
      setTimeout(function() {
        requestAnimationFrame(loop);
      }, 1000 / fps);
    }

    function disconnected() {
      html.innerHTML = "<p>Please Connect The Controller</p>";
      connected = false;
    }

    // Events
    // https://developer.mozilla.org/en-US/docs/Web/API/Gamepad_API/Using_the_Gamepad_API
    window.addEventListener('load', (event) => {
      disconnected();
    });

    window.addEventListener("gamepadconnected", function(e) {
      console.log("Gamepad connected at index %d: %s. %d buttons, %d axes.",
        e.gamepad.index, e.gamepad.id,
        e.gamepad.buttons.length, e.gamepad.axes.length);

      // Start the game loop trigger.
      connected = true;
      doLoop();

    });
    window.addEventListener("gamepaddisconnected", function(e) {
      console.log("Gamepad disconnected from index %d: %s",
        e.gamepad.index, e.gamepad.id);

      disconnected();

    });
  </script>
</body>

</html>